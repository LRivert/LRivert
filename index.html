<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>超级玛丽网页版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            position: relative;
            border: 5px solid #333;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            background: #7fc8f8;
            overflow: hidden;
        }
        
        canvas {
            display: block;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 800px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
        }
        
        .score-board, .lives-board {
            font-size: 24px;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: #ffcb05;
            border: none;
            color: #3c5aa6;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #c7a008;
        }
        
        .control-btn:hover {
            background: #ffde05;
            transform: translateY(-2px);
        }
        
        .control-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #c7a008;
        }
        
        .start-screen, .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .title {
            font-size: 48px;
            margin-bottom: 30px;
            color: #ffcb05;
            text-shadow: 3px 3px 0 #3c5aa6;
        }
        
        .game-over {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ff4757;
        }
        
        .final-score {
            font-size: 28px;
            margin-bottom: 30px;
        }
        
        .hidden {
            display: none;
        }
        
        .instructions {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            max-width: 600px;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #ffcb05;
        }
        
        .instructions p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="game-info">
        <div class="score-board">分数: <span id="score">0</span></div>
        <div class="lives-board">生命: <span id="lives">3</span></div>
    </div>
    
    <div class="game-container">
        <div class="start-screen" id="startScreen">
            <h1 class="title">超级玛丽</h1>
            <button class="control-btn" id="startBtn">开始游戏</button>
            <div class="instructions">
                <h3>游戏操作</h3>
                <p>← →: 左右移动</p>
                <p>↑ / 空格: 跳跃</p>
                <p>↓: 下蹲</p>
                <p>收集金币加分，避开敌人，到达终点获胜！</p>
            </div>
        </div>
        
        <div class="game-over-screen hidden" id="gameOverScreen">
            <h2 class="game-over">游戏结束</h2>
            <div class="final-score">最终得分: <span id="finalScore">0</span></div>
            <button class="control-btn" id="restartBtn">重新开始</button>
        </div>
        
        <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="leftBtn">←</button>
        <button class="control-btn" id="upBtn">↑</button>
        <button class="control-btn" id="rightBtn">→</button>
        <button class="control-btn" id="downBtn">↓</button>
    </div>

    <script>
        // 获取DOM元素
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const finalScoreElement = document.getElementById('finalScore');
        const leftBtn = document.getElementById('leftBtn');
        const upBtn = document.getElementById('upBtn');
        const rightBtn = document.getElementById('rightBtn');
        const downBtn = document.getElementById('downBtn');
        
        // 游戏变量
        let score = 0;
        let lives = 3;
        let gameRunning = false;
        
        // 玩家对象
        const player = {
            x: 50,
            y: 300,
            width: 40,
            height: 60,
            velocityX: 0,
            velocityY: 0,
            speed: 5,
            jumping: false,
            grounded: false,
            direction: 'right',
            ducking: false
        };
        
        // 游戏对象数组
        let platforms = [];
        let coins = [];
        let enemies = [];
        let goal = {};
        
        // 键盘控制
        const keys = {
            left: false,
            right: false,
            up: false,
            down: false
        };
        
        // 初始化游戏
        function initGame() {
            // 重置玩家状态
            player.x = 50;
            player.y = 300;
            player.velocityX = 0;
            player.velocityY = 0;
            player.jumping = false;
            player.grounded = false;
            
            // 重置分数和生命
            score = 0;
            lives = 3;
            updateScore();
            updateLives();
            
            // 创建平台
            platforms = [
                // 地面
                { x: 0, y: canvas.height - 20, width: canvas.width, height: 20 },
                // 平台
                { x: 200, y: 300, width: 150, height: 20 },
                { x: 400, y: 250, width: 150, height: 20 },
                { x: 600, y: 200, width: 150, height: 20 },
                // 砖块
                { x: 150, y: 150, width: 50, height: 20 },
                { x: 350, y: 100, width: 50, height: 20 },
                { x: 550, y: 50, width: 50, height: 20 }
            ];
            
            // 创建金币
            coins = [];
            for (let i = 0; i < 15; i++) {
                coins.push({
                    x: Math.random() * (canvas.width - 40),
                    y: Math.random() * (canvas.height - 100),
                    width: 20,
                    height: 20,
                    collected: false,
                    rotation: 0
                });
            }
            
            // 创建敌人
            enemies = [
                { x: 300, y: 280, width: 40, height: 40, speed: 2, direction: 1 },
                { x: 500, y: 230, width: 40, height: 40, speed: 1.5, direction: -1 },
                { x: 700, y: 180, width: 40, height: 40, speed: 2.5, direction: 1 }
            ];
            
            // 创建终点
            goal = {
                x: canvas.width - 80,
                y: 180,
                width: 60,
                height: 80
            };
            
            gameRunning = true;
            gameLoop();
        }
        
        // 更新分数显示
        function updateScore() {
            scoreElement.textContent = score;
            finalScoreElement.textContent = score;
        }
        
        // 更新生命显示
        function updateLives() {
            livesElement.textContent = lives;
        }
        
        // 碰撞检测
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // 处理玩家移动
        function handlePlayerMovement() {
            // 水平移动
            if (keys.left) {
                player.velocityX = -player.speed;
                player.direction = 'left';
            } else if (keys.right) {
                player.velocityX = player.speed;
                player.direction = 'right';
            } else {
                player.velocityX = 0;
            }
            
            // 跳跃
            if (keys.up && !player.jumping && player.grounded) {
                player.velocityY = -15;
                player.jumping = true;
                player.grounded = false;
            }
            
            // 下蹲
            player.ducking = keys.down;
            
            // 应用重力
            player.velocityY += 0.7;
            
            // 更新位置
            player.x += player.velocityX;
            player.y += player.velocityY;
            
            // 边界检查
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
            
            // 平台碰撞检测
            player.grounded = false;
            platforms.forEach(platform => {
                if (checkCollision(player, platform)) {
                    if (player.velocityY > 0 && player.y + player.height <= platform.y + 10) {
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.grounded = true;
                        player.jumping = false;
                    } else if (player.velocityY < 0) {
                        player.y = platform.y + platform.height;
                        player.velocityY = 0;
                    }
                }
            });
            
            // 防止掉落
            if (player.y > canvas.height) {
                resetPlayer();
            }
        }
        
        // 处理敌人移动
        function handleEnemyMovement() {
            enemies.forEach(enemy => {
                enemy.x += enemy.speed * enemy.direction;
                
                // 敌人平台检测
                let enemyGrounded = false;
                platforms.forEach(platform => {
                    if (enemy.x < platform.x + platform.width &&
                        enemy.x + enemy.width > platform.x &&
                        enemy.y + enemy.height >= platform.y &&
                        enemy.y + enemy.height <= platform.y + 10) {
                        enemyGrounded = true;
                    }
                });
                
                // 敌人碰撞检测和方向反转
                platforms.forEach(platform => {
                    if (checkCollision(enemy, platform)) {
                        enemy.direction *= -1;
                    }
                });
                
                // 边界检查
                if (enemy.x < 0 || enemy.x > canvas.width - enemy.width) {
                    enemy.direction *= -1;
                }
                
                // 敌人玩家碰撞
                if (checkCollision(player, enemy)) {
                    // 玩家从上方踩敌人
                    if (player.velocityY > 0 && player.y + player.height <= enemy.y + 20) {
                        player.velocityY = -10;
                        player.jumping = true;
                        // 移除敌人
                        enemies = enemies.filter(e => e !== enemy);
                        score += 100;
                        updateScore();
                    } else {
                        // 玩家碰到敌人
                        resetPlayer();
                    }
                }
            });
        }
        
        // 处理金币收集
        function handleCoinCollection() {
            coins.forEach(coin => {
                if (!coin.collected && checkCollision(player, coin)) {
                    coin.collected = true;
                    score += 50;
                    updateScore();
                }
            });
        }
        
        // 检查终点
        function checkGoal() {
            if (checkCollision(player, goal)) {
                gameWin();
            }
        }
        
        // 重置玩家位置
        function resetPlayer() {
            player.x = 50;
            player.y = 300;
            player.velocityX = 0;
            player.velocityY = 0;
            player.jumping = false;
            player.grounded = false;
            
            lives--;
            updateLives();
            
            if (lives <= 0) {
                gameOver();
            }
        }
        
        // 游戏结束
        function gameOver() {
            gameRunning = false;
            gameOverScreen.classList.remove('hidden');
        }
        
        // 游戏胜利
        function gameWin() {
            gameRunning = false;
            alert(`恭喜你获胜！最终得分: ${score}`);
            gameOverScreen.classList.remove('hidden');
        }
        
        // 绘制背景
        function drawBackground() {
            // 天空背景
            ctx.fillStyle = '#7fc8f8';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 云朵
            ctx.fillStyle = 'white';
            for (let i = 0; i < 5; i++) {
                const x = i * 200 + (Date.now() / 10000) % 100;
                ctx.beginPath();
                ctx.arc(x, 80, 30, 0, Math.PI * 2);
                ctx.arc(x + 25, 70, 25, 0, Math.PI * 2);
                ctx.arc(x + 40, 80, 20, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // 绘制平台
        function drawPlatforms() {
            platforms.forEach(platform => {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                ctx.fillStyle = '#A0522D';
                ctx.fillRect(platform.x, platform.y, platform.width, 5);
            });
        }
        
        // 绘制玩家
        function drawPlayer() {
            ctx.save();
            
            // 玩家身体
            ctx.fillStyle = '#3c5aa6';
            const width = player.ducking ? player.width * 1.5 : player.width;
            const height = player.ducking ? player.height / 2 : player.height;
            const x = player.ducking ? player.x - player.width / 4 : player.x;
            const y = player.ducking ? player.y + player.height / 2 : player.y;
            
            ctx.fillRect(x, y, width, height);
            
            // 玩家头部
            ctx.fillStyle = '#ffcb05';
            ctx.beginPath();
            ctx.arc(
                player.direction === 'right' ? x + width - 15 : x + 15,
                y + 15,
                10,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            // 眼睛
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(
                player.direction === 'right' ? x + width - 12 : x + 18,
                y + 13,
                3,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            // 瞳孔
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(
                player.direction === 'right' ? x + width - 11 : x + 19,
                y + 13,
                1.5,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            ctx.restore();
        }
        
        // 绘制金币
        function drawCoins() {
            coins.forEach(coin => {
                if (!coin.collected) {
                    ctx.save();
                    ctx.translate(coin.x + coin.width / 2, coin.y + coin.height / 2);
                    ctx.rotate(coin.rotation * Math.PI / 180);
                    
                    // 金币
                    ctx.fillStyle = '#ffd700';
                    ctx.beginPath();
                    ctx.arc(0, 0, 10, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // 金币细节
                    ctx.strokeStyle = '#ffc107';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(0, 0, 7, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    ctx.restore();
                    
                    // 更新金币旋转
                    coin.rotation += 5;
                }
            });
        }
        
        // 绘制敌人
        function drawEnemies() {
            enemies.forEach(enemy => {
                // 敌人身体
                ctx.fillStyle = '#ff4757';
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // 敌人眼睛
                ctx.fillStyle = 'white';
                const eyeSize = 8;
                const eyeY = enemy.y + 10;
                
                if (enemy.direction === 1) {
                    ctx.fillRect(enemy.x + enemy.width - 20, eyeY, eyeSize, eyeSize);
                } else {
                    ctx.fillRect(enemy.x + 12, eyeY, eyeSize, eyeSize);
                }
                
                // 敌人瞳孔
                ctx.fillStyle = 'black';
                const pupilSize = 4;
                const pupilY = enemy.y + 12;
                
                if (enemy.direction === 1) {
                    ctx.fillRect(enemy.x + enemy.width - 18, pupilY, pupilSize, pupilSize);
                } else {
                    ctx.fillRect(enemy.x + 14, pupilY, pupilSize, pupilSize);
                }
            });
        }
        
        // 绘制终点
        function drawGoal() {
            // 城堡
            ctx.fillStyle = '#95a5a6';
            ctx.fillRect(goal.x, goal.y, goal.width, goal.height);
            
            // 门
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(goal.x + goal.width / 3, goal.y + goal.height / 3, goal.width / 3, goal.height / 2);
            
            // 旗子
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(goal.x + goal.width, goal.y, 5, 40);
            ctx.beginPath();
            ctx.moveTo(goal.x + goal.width + 5, goal.y);
            ctx.lineTo(goal.x + goal.width + 30, goal.y + 15);
            ctx.lineTo(goal.x + goal.width + 5, goal.y + 30);
            ctx.fill();
        }
        
        // 游戏渲染
        function render() {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制游戏元素
            drawBackground();
            drawPlatforms();
            drawCoins();
            drawEnemies();
            drawGoal();
            drawPlayer();
        }
        
        // 游戏主循环
        function gameLoop() {
            if (!gameRunning) return;
            
            // 更新游戏状态
            handlePlayerMovement();
            handleEnemyMovement();
            handleCoinCollection();
            checkGoal();
            
            // 渲染游戏画面
            render();
            
            // 继续循环
            requestAnimationFrame(gameLoop);
        }
        
        // 事件监听器
        startBtn.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            initGame();
        });
        
        restartBtn.addEventListener('click', () => {
            gameOverScreen.classList.add('hidden');
            initGame();
        });
        
        // 键盘控制
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
            if (e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
            if (e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') keys.up = true;
            if (e.key === 'ArrowDown' || e.key === 's') keys.down = true;
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
            if (e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
            if (e.key === 'ArrowUp' || e.key === 'w' || e.key === ' ') keys.up = false;
            if (e.key === 'ArrowDown' || e.key === 's') keys.down = false;
        });
        
        // 按钮控制
        leftBtn.addEventListener('mousedown', () => keys.left = true);
        leftBtn.addEventListener('mouseup', () => keys.left = false);
        leftBtn.addEventListener('mouseleave', () => keys.left = false);
        
        rightBtn.addEventListener('mousedown', () => keys.right = true);
        rightBtn.addEventListener('mouseup', () => keys.right = false);
        rightBtn.addEventListener('mouseleave', () => keys.right = false);
        
        upBtn.addEventListener('mousedown', () => keys.up = true);
        upBtn.addEventListener('mouseup', () => keys.up = false);
        upBtn.addEventListener('mouseleave', () => keys.up = false);
        
        downBtn.addEventListener('mousedown', () => keys.down = true);
        downBtn.addEventListener('mouseup', () => keys.down = false);
        downBtn.addEventListener('mouseleave', () => keys.down = false);
    </script>
</body>
</html>